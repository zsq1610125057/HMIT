<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"   
						"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
	<select id="getAllCustomers" resultClass="com.vos.Customer">
	<![CDATA[
		select cusid,comname as compName,address,contact,cusname as cusName from customer 
	]]>
	</select>
	<select id="getProject" resultClass="com.vos.Project" parameterClass="com.vos.ProSearchVO">
	  <![CDATA[
	  select * from project 
	  ]]>
	  <dynamic prepend="WHERE">      
                 <isNotEmpty prepend="AND" property="status">       
                     <![CDATA[ status =#status#]]>    
                 </isNotEmpty> 
                  <isNotEmpty prepend="AND" property="pTName">       
                     <![CDATA[ pTName =#pTName#]]>    
                 </isNotEmpty> 
                  <isNotEmpty prepend="AND" property="proBrokerage">       
                     <![CDATA[ proBrokerage =#proBrokerage#]]>    
                 </isNotEmpty> 
                   <isNotEmpty prepend="AND" property="cusId">       
                     <![CDATA[ cusId =#cusId#]]>    
                 </isNotEmpty>         
		 </dynamic>	
		limit #firstRow#,#pageSize#
	</select>
	<select id="getProjectCount" resultClass="java.lang.Integer" >
	  select count(*) from project 
	</select>
	<select id="getProjectTypeList" resultClass="com.vos.ProjectTypeVo">
	<![CDATA[
		select ptid as id,ptname as name from projecttype
	]]>
	</select>
	
	<select id="getProBrokeragList" resultClass="com.vos.Employees">
	<![CDATA[
		select * from employees
	]]>
	</select>
	
	<select id="getSupplierList" resultClass="com.vos.Supplier">
	<![CDATA[
		select supId,supName,contactPersonName,contact,address,totalPaymentAmount from supplier
	]]>
	</select>
	
	<select id="getPayTypeList" resultClass="com.vos.PayTypeVo">
	<![CDATA[
		select PWId as id ,PWName as name from payway
	]]>
	</select>
	<select id="getProjectNameList" resultClass="com.vos.Project">
	<![CDATA[
		select proId as id ,proName  from project where status='已立项'
	]]>
	</select>
	<select id="getProjectAllNameList" resultClass="com.vos.Project">
	<![CDATA[
		select proId as id ,proName  from project 
	]]>
	</select>
	<insert id="saveNewProject" parameterClass="com.vos.Project">
		<![CDATA[
		INSERT into project(CusId,ProName,PTName,ProMoney,ProBrokerage,ReceivablesDate,ConId,SignDate,BeginDate,ProRemarks,IfMidAgent,ifAccessories,status,LastUpdateBy,LastUpdateDate) values(#cusId#,
				#proName#,#proType#,#proMoney#,#proBrokerage#,str_to_date(#recevablesDate#, '%m/%d/%Y'),
				#conId#,str_to_date(#signDate#, '%m/%d/%Y'),str_to_date(#beginDate#, '%m/%d/%Y'),#remarks#,#ifMigAgent#,#ifAccessories#,#status#,#lastUpdateBy#,str_to_date(now(),'%Y-%m-%d %H:%i:%s'))
	]]>
	  <selectKey resultClass="java.lang.Integer"  keyProperty="id" >    
             SELECT last_insert_id() as id   
        </selectKey>  
	</insert>
	<insert id="saveOrder" parameterClass="com.vos.Order">
		insert into purchaseorder(ProId,EquName,EquDescription,EquNumber,SellTotalPrice,IfWholesale,OrderRemarks,status,SellUnitPrice,LastUpdateBy,LastUpdateDate) values (#proId#,#equName#,#equDescription#,#equNumber#,#sellTotalPrice#,
				#ifWholeSale#,#remarks#,#status#,#sellPrice#,#lastUpdateBy#,str_to_date(now(),'%Y-%m-%d %H:%i:%s'))
	
	</insert>
<!-- 	<parameterMap class="java.util.Map" id="orderListPara"> -->
<!-- 		<parameter property="beginRow" mode="IN" javaType="java.lang.Integer" jdbcType="INTEGER"/> -->
<!-- 		<parameter property="endRow" mode="IN" javaType="java.lang.Integer" jdbcType="INTEGER"/> -->
<!-- 		<parameter property="list" mode="OUT" javaType="java.sql.ResultSet" jdbcType="ORACLECURSOR" resultMap="searchResult"/> -->

<!-- 	</parameterMap> -->
<!-- 	<resultMap class="com.vos.Order" id="searchResult"> -->
<!-- 		 <result property="ordId" column="id" jdbcType="INTEGER" nullValue=""/>   -->
<!-- 		 <result property="equDescription" column="equDescription" jdbcType="VARCHAR" nullValue=""/> -->
<!-- 		 <result property="equNumber" column="equNumber" jdbcType="INTEGER" nullValue=""/>  -->
<!-- 		 <result property="sellPrice" column="sellUnitPrice" jdbcType="FLOAT" nullValue=""/>  -->
<!-- 		 <result property="sellTotalPrice" column="sellTotalPrice" jdbcType="FLOAT" nullValue=""/>  -->
<!-- 		 <result property="supName" column="supName" jdbcType="VARCHAR" nullValue=""/>  -->
<!-- 		 <result property="costUnitPrice" column="costUnitPrice" jdbcType="FLOAT" nullValue=""/>  -->
<!-- 		 <result property="costPrice" column="costPrice" jdbcType="FLOAT" nullValue=""/>  -->
<!-- 		 <result property="payRemarks" column="payRemarks" jdbcType="VARCHAR" nullValue=""/>  -->
<!-- 		 <result property="status" column="status" jdbcType="VARCHAR" nullValue=""/>  -->
<!-- 		 <result property="proName" column="proName" jdbcType="VARCHAR" nullValue=""/>   -->
<!-- 	</resultMap> -->
<!-- 	<procedure id="getOrderListByPager" parameterMap="orderListPara"> -->
<!-- 		{call hmit.get_order_list(?,?,?)} -->
<!-- 	</procedure> -->
	<select id="getOrderListByPager" resultClass="com.vos.Order"
		parameterClass="java.util.Map">
			<![CDATA[
				select payables,invId,equDescription,sellTotalPrice,equName,status,sellPrice,ordId,equNumber,proName,proId,costUnitPrice,costPrice,payRemarks,IFNULL(a.SupId,"") as supId,s.SupName as supName from (SELECT
					
					IFNULL(po.payables,"") AS payables,
					po.InvId AS invId,
					po.EquDescription AS equDescription,
					po.SellTotalPrice AS sellTotalPrice,
					po.EquName AS equName,
					po.status,
					po.SellUnitPrice AS sellPrice,
					po.OrdId AS ordId,
					po.EquNumber AS equNumber,
					pt.ProName AS proName,
					po.ProId AS proId,
					IFNULL(po.CostUnitPrice,"") AS CostUnitPrice,
					IFNULL(po.CostPrice,"") AS CostPrice,
					IFNULL(po.PayRemarks,"") AS PayRemarks,
					po.SupId as SupId
					FROM
					purchaseorder AS po ,
					project AS pt]]>
					<dynamic prepend="WHERE">
					<![CDATA[po.ProId = pt.ProId]]>
                   <isNotEmpty prepend="AND" property="proId">       
                     <![CDATA[and po.ProId =#proId#]]>    
                 </isNotEmpty> 
                 <isNotEmpty prepend="AND" property="equName">       
                     <![CDATA[and po.EquName =#equName#]]>    
                 </isNotEmpty> 
                 <isNotEmpty prepend="AND" property="status">       
                     <![CDATA[and po.status =#status#]]>    
                 </isNotEmpty> 
                 <isNotEmpty prepend="AND" property="supId">       
                     <![CDATA[and po.SupId =#supId#]]>    
                 </isNotEmpty>          
		          </dynamic>		
					
					  ) a LEFT JOIN supplier s on a.SupId = s.SupId limit #beginRow#,#pageSize#
			
			
            
	</select>
	<select id="getOrderCount" resultClass="java.lang.Integer">
		<![CDATA[
			select count(*) from purchaseorder;
		]]>
	</select>
	
	<update id="updateOrderSupInfo" parameterClass="com.vos.Order">
		update purchaseOrder set equNumber = #equNumber#,CostUnitPrice=#costUnitPrice#,CostPrice=#costPrice#,SellTotalPrice=#sellTotalPrice#,SellUnitPrice=#sellPrice#,
			PayRemarks=#payRemarks#,status=#action#,LastUpdateBy=#lastUpdateBy#,LastUpdateDate=str_to_date(now(),'%Y-%m-%d %H:%i:%s'),supId = #supId# where ordId = #ordId#
	</update>
	<update id="updateOrderSupInfo1" parameterClass="com.vos.Order">
		update purchaseOrder set payRemarks=#payRemarks#,status=#action#,LastUpdateBy=#lastUpdateBy#,LastUpdateDate=str_to_date(now(),'%Y-%m-%d %H:%i:%s'),pWName=#payWay#,payDate=str_to_date(#payDate#, '%m/%d/%Y'),payables=#payables# where ordId = #ordId#
	</update>
	<update id="updateorderofinv" parameterClass="com.vos.Order">
		update purchaseOrder set status=#action#,LastUpdateBy=#lastUpdateBy#,LastUpdateDate=str_to_date(now(),'%Y-%m-%d %H:%i:%s'),InvId=#invId# where ordId = #ordId#
	</update>
	<update id="updateOrderArrival" parameterClass="com.vos.Order">
	
		update purchaseOrder set LastUpdateBy=#lastUpdateBy#,LastUpdateDate=str_to_date(now(),'%Y-%m-%d %H:%i:%s'),payRemarks=#payRemarks#,status=#action#,arrivalTime=str_to_date(#arrivalTime#,'%m/%d/%Y'),payables=#payables# where  ordid = #ordId#

	</update>
	<update id="updateOrderWMId" parameterClass="java.util.Map">
	<![CDATA[
		update purchaseOrder set wMId=#wMId#,difference=#difference# where  ordid = #ordId#
	]]>
	</update>
	<update id="updateProjectStatus" parameterClass="java.util.Map">
	<![CDATA[
		update project set LastUpdateBy=#lastUpdateBy#,LastUpdateDate=str_to_date(now(),'%Y-%m-%d %H:%i:%s'),status=#action# where  proId = #id#
	]]>
	</update>
	<insert id="addschedule" parameterClass="com.vos.Schedule" >
	<![CDATA[
	insert  into proschedule(proId,addPeople,addDate,schedule) values (#proId#,#addPeople#,str_to_date(now(),'%Y-%m-%d %H:%i:%s'),#schedule#)
	]]>
	</insert>
	<select id="getProSchedule" parameterClass="java.util.Map" resultClass="com.vos.Schedule">
	<![CDATA[
	select addPeople,addDate,schedule from proschedule where proId=#proId#
	]]>
	</select>
	<select id="getProScheduleCount" parameterClass="java.util.Map" resultClass="java.lang.Integer">
	<![CDATA[
	select count(*) from proschedule where proId=#proId#
	]]>
	</select>
</sqlMap>